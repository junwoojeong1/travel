<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TravelPro — 여행 플래너 (상업형 UI)</title>

  <!-- React UMD + Babel (in-browser JSX) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    /* --- Theme & base --- */
    :root{
      --bg: #f3f6fb;
      --card: #ffffff;
      --muted: #6b7280;
      --text: #0f172a;
      --accent: #1366ff;
      --glass: rgba(255,255,255,0.7);
      --radius: 14px;
      --shadow: 0 12px 30px rgba(15,23,42,0.08);
      --gap: 14px;
      font-family: Inter, 'Noto Sans KR', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    .dark {
      --bg:#071428; --card:#0b1622; --muted:#9aa4b2; --text:#e6eef8; --glass: rgba(255,255,255,0.03);
    }

    *{box-sizing:border-box}
    html,body,#root{height:100%; margin:0; background:linear-gradient(180deg,var(--bg), #eaf2ff); color:var(--text); -webkit-font-smoothing:antialiased;}
    a{color:inherit;text-decoration:none}

    /* App shell */
    .app{min-height:100vh;display:flex;flex-direction:column}
    header.app-header{position:fixed;top:0;left:0;right:0;height:72px;display:flex;align-items:center;justify-content:space-between;padding:14px 18px;background:linear-gradient(180deg, rgba(255,255,255,0.9), rgba(255,255,255,0.8));box-shadow:0 6px 20px rgba(13,18,35,0.04);z-index:60;border-bottom-left-radius:0;border-bottom-right-radius:0}
    .dark header.app-header{background:rgba(8,12,20,0.5);border-bottom:1px solid rgba(255,255,255,0.03)}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent), #6e4dff);display:flex;align-items:center;justify-content:center;color:white;font-weight:800;box-shadow:0 10px 30px rgba(19,102,255,0.12)}
    .title{font-size:18px;font-weight:800}
    .header-actions{display:flex;gap:8px;align-items:center}

    main.content{padding-top:100px;padding-bottom:100px;width:100%;max-width:1180px;margin:22px auto;box-sizing:border-box}
    .container{display:grid;grid-template-columns:1fr;gap:var(--gap)}

    /* hero */
    .hero{display:flex;gap:20px;align-items:center;padding:22px;border-radius:18px;background:linear-gradient(90deg,var(--accent),#6e4dff);color:white;box-shadow:var(--shadow)}
    .hero h1{margin:0;font-size:28px}
    .hero p{margin:6px 0 0 0;opacity:0.95}

    /* card */
    .card{background:var(--card);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(0,0,0,0.03)}
    .dark .card{border:1px solid rgba(255,255,255,0.03)}

    /* date banner */
    .date-banner{margin-top:12px;padding:10px;border-radius:12px;background:linear-gradient(90deg, rgba(19,102,255,0.08), rgba(19,102,255,0.02));display:flex;justify-content:space-between;align-items:center}
    .date-text{font-weight:700}

    /* grids */
    .grid-2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    @media(max-width:920px){ .grid-2,.grid-3{grid-template-columns:1fr} .hero{flex-direction:column;align-items:flex-start} }

    /* inputs */
    .input{width:100%;padding:10px 12px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);font-size:14px}
    .input.small{font-size:13px;padding:8px 10px}
    .input.large{font-size:18px;padding:14px 12px;font-weight:700}
    .textarea{min-height:80px;padding:10px;border-radius:8px;border:1px solid rgba(0,0,0,0.06);resize:vertical}
    .muted{color:var(--muted);font-size:13px}

    /* buttons */
    .btn{display:inline-flex;align-items:center;gap:10px;padding:10px 14px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
    .btn.ghost{background:transparent;border:1px solid rgba(0,0,0,0.06)}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#6e4dff);color:white;box-shadow:0 8px 20px rgba(14,40,120,0.12)}

    /* lists */
    .list .item{display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:10px;border:1px solid rgba(0,0,0,0.05);background:linear-gradient(180deg,#fff,#fbfdff)}
    .list .meta{display:flex;justify-content:space-between;color:var(--muted);font-size:13px}

    /* map */
    .map-wrap{width:100%;height:260px;border-radius:10px;overflow:hidden;border:1px solid rgba(0,0,0,0.06)}
    .map-iframe{width:100%;height:100%;border:0}

    /* bottom nav (mobile) */
    .bottom-nav{position:fixed;left:12px;right:12px;bottom:12px;height:64px;background:var(--card);border-radius:12px;display:flex;justify-content:space-around;align-items:center;box-shadow:0 14px 36px rgba(2,6,23,0.08);z-index:70;border:1px solid rgba(0,0,0,0.04)}
    .nav-btn{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted);cursor:pointer}
    .nav-btn.active{color:var(--accent);font-weight:800}

    /* utilities */
    .row{display:flex;gap:10px;align-items:center}
    .col{display:flex;flex-direction:column;gap:8px}
    .card-hero{background:linear-gradient(90deg,rgba(19,102,255,0.06),rgba(19,102,255,0.02));padding:12px;border-radius:12px}
    small.note{display:block;color:var(--muted);font-size:12px;margin-top:6px}

  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
  const {useState, useEffect, useRef} = React;

  /***** Storage keys *****/
  const KEY_DATES = 'tp_dates_v2';
  const KEY_FLIGHTS = 'tp_flights_v2';
  const KEY_PLACES = 'tp_places_v2';
  const KEY_DESTS = 'tp_dests_v2';
  const KEY_POINTS = 'tp_points_v2';
  const KEY_COURSES = 'tp_courses_v2';
  const KEY_THEME = 'tp_theme_v2';

  /***** Utilities *****/
  function safeJSONParse(v, fallback){
    try{ return v ? JSON.parse(v) : fallback; } catch(e){ return fallback; }
  }
  function load(key, fallback){ return safeJSONParse(localStorage.getItem(key), fallback); }
  function save(key, obj){ try{ localStorage.setItem(key, JSON.stringify(obj)); }catch(e){ console.warn('save failed', key, e); } }

  function formatRange(from, to){ if(!from && !to) return ''; if(!from) return `→ ${to}`; if(!to) return `${from} →`; return `${from} → ${to}`; }

  /***** Routing helpers (hash + history) *****/
  function getInitialRoute(){
    const h = location.hash.replace(/^#/, '');
    return h || 'home';
  }
  function navigateTo(route){
    if(!route) route = 'home';
    history.pushState({route}, '', '#' + route);
    window.dispatchEvent(new PopStateEvent('popstate', {state:{route}}));
  }

  /***** Sample data (minimal) *****/
  function sampleFlights(){ return [{id:'f_s1', airline:'AirPro', from:'ICN', to:'HND', depart:'08:30', arrive:'10:50', price:'150000', site:'https://booking.example/1', notes:'직항'}]; }
  function samplePlaces(){ return [{id:'p_s1', name:'City Hotel', location:'Seoul, Korea', price:'120000', nights:'2', site:'https://hotel.example/1', notes:'조식 포함'}]; }
  function sampleDests(){ return [{id:'d_s1', name:'Jeju', pref:8, query:'Jeju Island'}]; }
  function samplePoints(){ return []; }

  /***** App component: holds global dates & theme *****/
  function App(){
    const [route, setRoute] = useState(getInitialRoute());
    const [dates, setDates] = useState(() => load(KEY_DATES, {from:'', to:'', saved:false}));
    const [theme, setTheme] = useState(()=> load(KEY_THEME, {mode:'light', accent:'#1366ff'}));
    // data collections
    const [flights, setFlights] = useState(()=> load(KEY_FLIGHTS, sampleFlights()));
    const [places, setPlaces] = useState(()=> load(KEY_PLACES, samplePlaces()));
    const [dests, setDests] = useState(()=> load(KEY_DESTS, sampleDests()));
    const [points, setPoints] = useState(()=> load(KEY_POINTS, samplePoints()));
    const [courses, setCourses] = useState(()=> load(KEY_COURSES, {}));

    // persist collections on change
    useEffect(()=> save(KEY_FLIGHTS, flights), [flights]);
    useEffect(()=> save(KEY_PLACES, places), [places]);
    useEffect(()=> save(KEY_DESTS, dests), [dests]);
    useEffect(()=> save(KEY_POINTS, points), [points]);
    useEffect(()=> save(KEY_COURSES, courses), [courses]);
    useEffect(()=> save(KEY_DATES, dates), [dates]);
    useEffect(()=> save(KEY_THEME, theme), [theme]);

    // theme application
    useEffect(()=> {
      document.documentElement.classList.toggle('dark', theme.mode === 'dark');
      document.documentElement.style.setProperty('--accent', theme.accent || '#1366ff');
    }, [theme]);

    // routing (popstate handler)
    useEffect(()=>{
      function onPop(e){
        const r = (e.state && e.state.route) || getInitialRoute();
        setRoute(r);
      }
      window.addEventListener('popstate', onPop);
      // ensure initial history state is set
      if(!history.state || !history.state.route) history.replaceState({route}, '', '#'+route);
      return ()=> window.removeEventListener('popstate', onPop);
    }, []);

    // helper to update global dates from Home
    const updateDates = (newDates) => setDates(newDates);

    // route parser
    const routeBase = route.split('/')[0];

    return (
      <div className="app">
        <Header onNavigate={(r)=>{ navigateTo(r); setRoute(r); }} />
        <main className="content">
          <div className="container">
            {/* Hero + top controls */}
            <Hero dates={dates} onNavigate={(r)=>{ navigateTo(r); setRoute(r); }} />

            {/* show current page */}
            <div className="card">
              {routeBase === 'home' && <Home dates={dates} updateDates={updateDates} onNavigate={(r)=>{ navigateTo(r); setRoute(r); }} />}
              {routeBase === 'list' && <ListPage onNavigate={(r)=>{ navigateTo(r); setRoute(r); }} dates={dates} />}
              {routeBase === 'flights' && <FlightsPage dates={dates} flights={flights} setFlights={setFlights} />}
              {routeBase === 'accommodation' && <AccommodationPage dates={dates} places={places} setPlaces={setPlaces} />}
              {routeBase === 'destinations' && <DestinationsPage dates={dates} dests={dests} setDests={setDests} />}
              {routeBase === 'courses' && <CoursesPage dates={dates} points={points} setPoints={setPoints} courses={courses} setCourses={setCourses} />}
              {routeBase === 'settings' && <SettingsPage theme={theme} setTheme={setTheme} setDates={updateDates} clearAll={()=>{
                // clear all keys used by app
                ['tp_dates_v2','tp_flights_v2','tp_places_v2','tp_dests_v2','tp_points_v2','tp_courses_v2','tp_theme_v2'].forEach(k=>localStorage.removeItem(k));
                // refresh UI state
                setFlights(sampleFlights()); setPlaces(samplePlaces()); setDests(sampleDests()); setPoints([]); setCourses({}); setDates({from:'', to:'', saved:false}); setTheme({mode:'light', accent:'#1366ff'});
                alert('로컬 데이터가 초기화 되었습니다. 페이지를 새로고침하세요.');
              }} />}
              {routeBase === 'detail' && <DetailRouter route={route} dates={dates} flights={flights} places={places} dests={dests} points={points} />}
            </div>
          </div>
        </main>

        <BottomNav current={routeBase} onNavigate={(r)=>{ navigateTo(r); setRoute(r); }} />
      </div>
    );
  }

  /***** Header & Hero *****/
  function Header({onNavigate}){
    return (
      <header className="app-header" role="banner">
        <div className="brand">
          <div className="logo">TP</div>
          <div>
            <div className="title">TravelPro</div>
            <div className="muted" style={{fontSize:13}}>Plan smarter — Book faster</div>
          </div>
        </div>

        <div className="header-actions">
          <button className="btn ghost" onClick={()=>onNavigate('home')}>Home</button>
          <button className="btn ghost" onClick={()=>onNavigate('list')}>목록</button>
          <button className="btn ghost" onClick={()=>onNavigate('settings')}>설정</button>
        </div>
      </header>
    );
  }

  function Hero({dates, onNavigate}){
    return (
      <div className="hero card" style={{alignItems:'flex-start'}}>
        <div style={{flex:1}}>
          <h1>당신의 다음 여행, 지금 설계하세요</h1>
          <p className="muted">직관적인 플로우로 항공/숙박/코스까지 한 번에 관리 — 비즈니스·레저 모두에 적합합니다.</p>

          <div style={{marginTop:18}} className="row">
            <button className="btn primary" onClick={()=>onNavigate('list')}>여행 시작하기</button>
            <button className="btn ghost" onClick={()=>onNavigate('flights')}>항공권 보기</button>
            <button className="btn ghost" onClick={()=>onNavigate('accommodation')}>숙소 보기</button>
          </div>

          {dates && dates.saved ? <div style={{marginTop:12}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}
        </div>

        <div style={{width:320}}>
          <div className="card-hero">
            <div style={{fontWeight:800}}>특별 혜택</div>
            <div className="muted" style={{marginTop:6}}>선택한 날짜에 맞춘 추천 항공/호텔 할인 정보를 곧 제공합니다.</div>
            <small className="note">(샘플 UI — 실제 제휴 연동은 API 필요)</small>
          </div>
        </div>
      </div>
    );
  }

  /***** Bottom Nav *****/
  function BottomNav({current, onNavigate}){
    return (
      <nav className="bottom-nav" role="navigation" aria-label="bottom">
        <div className={'nav-btn ' + (current==='home' ? 'active':'' )} onClick={()=>onNavigate('home')}>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 12l9-7 9 7v8a1 1 0 0 1-1 1h-5v-6h-6v6H4a1 1 0 0 1-1-1v-8z" stroke="currentColor" strokeWidth="1.2" strokeLinecap="round" strokeLinejoin="round"/></svg>
          <div>메인</div>
        </div>

        <div className={'nav-btn ' + (current==='list' ? 'active':'' )} onClick={()=>onNavigate('list')}>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" strokeWidth="1.4" strokeLinecap="round"/></svg>
          <div>목록</div>
        </div>

        <div className={'nav-btn ' + (current==='settings' ? 'active':'' )} onClick={()=>onNavigate('settings')}>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 15.5A3.5 3.5 0 1 0 12 8.5a3.5 3.5 0 0 0 0 7z" stroke="currentColor" strokeWidth="1" strokeLinecap="round"/></svg>
          <div>설정</div>
        </div>
      </nav>
    );
  }

  /***** Pages *****/
  function Home({dates, updateDates, onNavigate}){
    const [local, setLocal] = useState({...dates});
    useEffect(()=> setLocal({...dates}), [dates]);

    function setDate(f,v){
      if(local.saved) return;
      setLocal(d=>({...d, [f]:v}));
    }
    function save(){
      if(!local.from || !local.to){ alert('출발/도착일을 모두 입력하세요.'); return; }
      const saved = {...local, saved:true};
      updateDates(saved);
      alert('날짜가 저장되었습니다. 모든 페이지에 반영됩니다.');
    }

    return (
      <div>
        <h2>대표 페이지</h2>
        <div className="muted" style={{marginTop:6}}>안녕하세요</div>

        <div style={{marginTop:12}} className="grid-2">
          <div className="card">
            <div style={{fontWeight:800}}>여행 일정 설정</div>
            <div style={{marginTop:8}}>
              <label className="muted small">출발</label>
              <input className={`input ${local.saved ? '' : ''}`} type="date" value={local.from||''} onChange={e=>setDate('from', e.target.value)} disabled={local.saved} />
            </div>
            <div style={{marginTop:8}}>
              <label className="muted small">복귀</label>
              <input className="input" type="date" value={local.to||''} onChange={e=>setDate('to', e.target.value)} disabled={local.saved} />
            </div>
            <div style={{marginTop:12, display:'flex', gap:10}}>
              <button className="btn primary" onClick={()=>{
                onNavigate('list');
              }}>목록으로 이동</button>
              <button className="btn ghost" onClick={save} disabled={local.saved}>날짜 저장</button>
            </div>
            {local.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(local.from, local.to)}</div><div className="muted">수정 불가 (설정에서 초기화)</div></div> : null}
          </div>

          <div className="card">
            <div style={{fontWeight:800}}>빠른 안내</div>
            <div className="muted" style={{marginTop:8}}>대표 페이지에서 날짜를 저장하면 앱 전체에 동일하게 반영됩니다. 출장·단체 여행에 유용합니다.</div>
            <small className="note">원하시면 제휴형 예약 연동(외부 API) 안내도 드립니다.</small>
          </div>
        </div>
      </div>
    );
  }

  function ListPage({onNavigate, dates}){
    return (
      <div>
        <h2>서비스 목록</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}

        <div style={{marginTop:12}} className="grid-2">
          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div><div style={{fontWeight:800}}>항공권</div><div className="muted small">출발·도착 공항을 강조 표시</div></div>
              <button className="btn" onClick={()=>onNavigate('flights')}>열기</button>
            </div>
          </div>

          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div><div style={{fontWeight:800}}>숙박</div><div className="muted small">호텔명 입력 시 자동 장소 검색·미리보기</div></div>
              <button className="btn" onClick={()=>onNavigate('accommodation')}>열기</button>
            </div>
          </div>

          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div><div style={{fontWeight:800}}>여행지</div><div className="muted small">검색·저장된 여행지 관리</div></div>
              <button className="btn" onClick={()=>onNavigate('destinations')}>열기</button>
            </div>
          </div>

          <div className="card">
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
              <div><div style={{fontWeight:800}}>코스</div><div className="muted small">좌표 기록 및 날짜별 코스 저장</div></div>
              <button className="btn" onClick={()=>onNavigate('courses')}>열기</button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  /***** Flights Page (improved layout) *****/
  function FlightsPage({dates, flights, setFlights}){
    const [form, setForm] = useState({airline:'', from:'', to:'', depart:'', arrive:'', price:'', site:'', notes:''});

    function add(){
      if(!form.from || !form.to){ alert('출발 및 도착 공항을 입력하세요'); return; }
      const item = {...form, id: Date.now().toString()};
      setFlights(prev => [item, ...prev]);
      setForm({airline:'', from:'', to:'', depart:'', arrive:'', price:'', site:'', notes:''});
    }
    function remove(id){ setFlights(prev => prev.filter(p=>p.id!==id)); }

    return (
      <div>
        <h2>항공편</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일이 적용됩니다</div></div> : null}

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>항공권 추가</div>
          <div style={{marginTop:12}} className="col">
            <input className="input" placeholder="항공사 (예: Korean Air)" value={form.airline} onChange={e=>setForm(f=>({...f, airline:e.target.value}))} />

            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginTop:8}}>
              <input className="input large" placeholder="출발 공항 (예: ICN)" value={form.from} onChange={e=>setForm(f=>({...f, from:e.target.value}))} />
              <input className="input large" placeholder="도착 공항 (예: NRT)" value={form.to} onChange={e=>setForm(f=>({...f, to:e.target.value}))} />
            </div>

            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:10,marginTop:8}}>
              <input className="input small" placeholder="출발 시간" value={form.depart} onChange={e=>setForm(f=>({...f, depart:e.target.value}))} />
              <input className="input small" placeholder="도착 시간" value={form.arrive} onChange={e=>setForm(f=>({...f, arrive:e.target.value}))} />
            </div>

            <div style={{display:'grid',gap:8,marginTop:8}}>
              <input className="input small" placeholder="예약 사이트 URL (선택)" value={form.site} onChange={e=>setForm(f=>({...f, site:e.target.value}))} />
              <input className="input small" placeholder="가격 (원)" value={form.price} onChange={e=>setForm(f=>({...f, price:e.target.value}))} />
              <textarea className="textarea" placeholder="메모" value={form.notes} onChange={e=>setForm(f=>({...f, notes:e.target.value}))} />
            </div>

            <div style={{marginTop:10}}>
              <button className="btn primary" onClick={add}>항공권 추가</button>
            </div>
          </div>
        </div>

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>저장된 항공권</div>
          <div style={{marginTop:10}} className="list">
            {flights.length === 0 ? <div className="muted">저장된 항공권이 없습니다.</div> : flights.map(f => (
              <div key={f.id} className="item">
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div><div style={{fontWeight:800}}>{f.from} → {f.to}</div><div className="muted small">{f.airline} · {f.depart} → {f.arrive}</div></div>
                  <div style={{display:'flex',gap:8}}>
                    {f.site ? <a className="btn ghost" target="_blank" rel="noreferrer" href={f.site}>예약 사이트</a> : null}
                    <button className="btn ghost" onClick={()=>remove(f.id)}>삭제</button>
                  </div>
                </div>
                <div className="muted small" style={{marginTop:6}}>가격: {f.price || '—'} · 메모: {f.notes || '—'}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  /***** Accommodation Page (hotel name auto-fills location) *****/
  function AccommodationPage({dates, places, setPlaces}){
    const [form, setForm] = useState({name:'', location:'', price:'', nights:'', site:'', notes:''});
    const [preview, setPreview] = useState('');

    // auto-fill location when name set (only if location empty)
    useEffect(()=> {
      if(form.name && !form.location){
        setForm(f=>({...f, location: f.name}));
      }
    }, [form.name]);

    function previewMap(){
      const q = form.location || form.name;
      if(!q) { alert('호텔명 또는 장소를 입력하세요'); return; }
      setPreview(q);
    }
    function add(){
      if(!form.name){ alert('호텔명을 입력하세요'); return; }
      const item = {...form, id:Date.now().toString()};
      setPlaces(prev => [item, ...prev]);
      setForm({name:'', location:'', price:'', nights:'', site:'', notes:''});
      setPreview('');
    }
    function remove(id){ setPlaces(prev => prev.filter(p=>p.id!==id)); }

    return (
      <div>
        <h2>숙박</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>숙소 추가</div>
          <div style={{marginTop:12}} className="col">
            <input className="input large" placeholder="호텔명 (예: Lotte Hotel Seoul)" value={form.name} onChange={e=>setForm(f=>({...f, name:e.target.value}))} />
            <input className="input" placeholder="장소 (자동 채움, 필요시 수정)" value={form.location} onChange={e=>setForm(f=>({...f, location:e.target.value}))} />
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginTop:8}}>
              <input className="input small" placeholder="가격/박" value={form.price} onChange={e=>setForm(f=>({...f, price:e.target.value}))} />
              <input className="input small" placeholder="예약 사이트 URL" value={form.site} onChange={e=>setForm(f=>({...f, site:e.target.value}))} />
            </div>
            <textarea className="textarea" placeholder="메모" value={form.notes} onChange={e=>setForm(f=>({...f, notes:e.target.value}))} />
            <div style={{display:'flex',gap:10,marginTop:8}}>
              <button className="btn primary" onClick={add}>숙소 추가</button>
              <button className="btn ghost" onClick={previewMap}>지도 미리보기</button>
            </div>
            <small className="note">참고: 정확한 좌표(위도/경도)는 Google Places/Geocoding API 연동이 필요합니다.</small>
          </div>
        </div>

        <div style={{marginTop:12}} className="card">
          <h3 className="small">구글맵 미리보기</h3>
          <div className="map-wrap" style={{marginTop:8}}>
            {preview ? <iframe className="map-iframe" title="hotel-preview" src={`https://www.google.com/maps?q=${encodeURIComponent(preview)}&output=embed`} /> : <div style={{padding:12}} className="muted">미리보기를 위해 호텔명 또는 장소를 입력하고 '지도 미리보기'를 눌러보세요.</div>}
          </div>
        </div>

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>저장된 숙소</div>
          <div style={{marginTop:10}} className="list">
            {places.length === 0 ? <div className="muted">저장된 숙소가 없습니다.</div> : places.map(p => (
              <div key={p.id} className="item">
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div><div style={{fontWeight:800}}>{p.name}</div><div className="muted small">{p.location} · {p.nights}박</div></div>
                  <div style={{display:'flex',gap:8}}>
                    {p.site ? <a className="btn ghost" target="_blank" rel="noreferrer" href={p.site}>예약 사이트</a> : null}
                    <button className="btn ghost" onClick={()=>remove(p.id)}>삭제</button>
                  </div>
                </div>
                <div className="muted small" style={{marginTop:6}}>가격: {p.price || '—'}</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  /***** Destinations (search + save) *****/
  function DestinationsPage({dates, dests, setDests}){
    const [name, setName] = useState('');
    const [pref, setPref] = useState(5);
    const [preview, setPreview] = useState('');

    function previewMap(){ if(!name){ alert('여행지명을 입력하세요'); return; } setPreview(name); }
    function add(){
      if(!name){ alert('여행지명을 입력하세요'); return; }
      const item = {id:Date.now().toString(), name, pref, query: name};
      setDests(prev => [item, ...prev]);
      setName(''); setPref(5); setPreview('');
    }
    function remove(id){ setDests(prev => prev.filter(d=>d.id!==id)); }

    return (
      <div>
        <h2>여행지</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}

        <div style={{marginTop:12}} className="grid-2">
          <div className="card">
            <div style={{fontWeight:800}}>여행지 추가</div>
            <input className="input" placeholder="여행지명 (예: 성산일출봉)" value={name} onChange={e=>setName(e.target.value)} style={{marginTop:8}} />
            <label className="muted small" style={{marginTop:8}}>선호도</label>
            <input type="range" min="1" max="10" value={pref} onChange={e=>setPref(Number(e.target.value))} />
            <div style={{display:'flex',gap:8,marginTop:8}}>
              <button className="btn primary" onClick={previewMap}>미리보기</button>
              <button className="btn ghost" onClick={add}>저장</button>
            </div>
            <small className="note">저장된 여행지는 목록에서 Google Maps로 열어 확인할 수 있습니다.</small>
          </div>

          <div className="card">
            <h3 className="small">구글맵 미리보기</h3>
            <div className="map-wrap" style={{marginTop:8}}>
              {preview ? <iframe className="map-iframe" title="dest-preview" src={`https://www.google.com/maps?q=${encodeURIComponent(preview)}&output=embed`} /> : <div style={{padding:12}} className="muted">여행지명을 입력하고 미리보기하세요.</div>}
            </div>
          </div>
        </div>

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>저장된 여행지</div>
          <div style={{marginTop:10}} className="list">
            {dests.length === 0 ? <div className="muted">저장된 여행지가 없습니다.</div> : dests.map(d => (
              <div key={d.id} className="item">
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div><div style={{fontWeight:800}}>{d.name}</div><div className="muted small">선호도: {d.pref}</div></div>
                  <div style={{display:'flex',gap:8}}>
                    <a className="btn ghost" target="_blank" rel="noreferrer" href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(d.query)}`}>지도에서 보기</a>
                    <button className="btn ghost" onClick={()=>remove(d.id)}>삭제</button>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  /***** Courses Page (map preview, points, save per date) *****/
  function CoursesPage({dates, points, setPoints, courses, setCourses}){
    const [form, setForm] = useState({name:'', lat:'', lng:'', duration:'60', priority:5});
    const [preview, setPreview] = useState('');
    const [courseName, setCourseName] = useState('');
    const [saveDate, setSaveDate] = useState(dates && dates.saved ? dates.from : '');

    useEffect(()=>{ if(dates && dates.saved) setSaveDate(dates.from); }, [dates]);

    function addPoint(){
      if(!form.name){ alert('명소명을 입력하세요'); return; }
      const p = {...form, id:Date.now().toString()};
      setPoints(prev => [p, ...prev]);
      setForm({name:'', lat:'', lng:'', duration:'60', priority:5});
    }
    function previewMap(){ if(!form.name){ alert('명소명을 입력하세요'); return; } setPreview(form.name); }
    function saveCourse(){
      if(!saveDate){ alert('저장할 날짜를 선택하세요'); return; }
      const course = {id: Date.now().toString(), name: courseName || `Course ${new Date().toLocaleString()}`, points};
      const copy = {...courses};
      if(!copy[saveDate]) copy[saveDate] = [];
      copy[saveDate].push(course);
      setCourses(copy);
      setPoints([]);
      setCourseName('');
      alert('코스가 저장되었습니다.');
    }
    function removePoint(id){ setPoints(prev => prev.filter(p=>p.id!==id)); }

    return (
      <div>
        <h2>코스 만들기</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}

        <div style={{marginTop:12}} className="grid-2">
          <div className="card">
            <div style={{fontWeight:800}}>명소 추가</div>
            <input className="input" placeholder="명소명" value={form.name} onChange={e=>setForm(f=>({...f, name:e.target.value}))} style={{marginTop:8}} />
            <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:8,marginTop:8}}>
              <input className="input small" placeholder="lat (선택)" value={form.lat} onChange={e=>setForm(f=>({...f, lat:e.target.value}))} />
              <input className="input small" placeholder="lng (선택)" value={form.lng} onChange={e=>setForm(f=>({...f, lng:e.target.value}))} />
            </div>
            <div style={{marginTop:8}}>
              <input className="input small" placeholder="체류시간(분)" value={form.duration} onChange={e=>setForm(f=>({...f, duration:e.target.value}))} />
            </div>
            <div style={{marginTop:8, display:'flex',gap:8}}>
              <button className="btn primary" onClick={addPoint}>명소 추가</button>
              <button className="btn ghost" onClick={previewMap}>미리보기</button>
            </div>

            <div style={{marginTop:12}}>
              <div style={{fontWeight:800}}>현재 코스 명소</div>
              <div style={{marginTop:8}} className="list">
                {points.length === 0 ? <div className="muted">아직 명소가 없습니다.</div> : points.map(pt => (
                  <div key={pt.id} className="item">
                    <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                      <div><div style={{fontWeight:800}}>{pt.name}</div><div className="muted small">{pt.duration}분 · 우선순위 {pt.priority}</div></div>
                      <div style={{display:'flex',gap:8}}>
                        <a className="btn ghost" target="_blank" rel="noreferrer" href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(pt.name)}`}>지도</a>
                        <button className="btn ghost" onClick={()=>removePoint(pt.id)}>삭제</button>
                      </div>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          </div>

          <div className="card">
            <h3 className="small">구글맵 미리보기</h3>
            <div className="map-wrap" style={{marginTop:8}}>
              {preview ? <iframe className="map-iframe" title="course-preview" src={`https://www.google.com/maps?q=${encodeURIComponent(preview)}&output=embed`} /> : <div style={{padding:12}} className="muted">명소명을 검색하면 미리보기가 표시됩니다.</div>}
            </div>

            <div style={{marginTop:12}}>
              <input className="input" placeholder="코스명 (선택)" value={courseName} onChange={e=>setCourseName(e.target.value)} />
              <div style={{display:'flex',gap:8,marginTop:8,alignItems:'center'}}>
                <input className="input small" type="date" value={saveDate} onChange={e=>setSaveDate(e.target.value)} style={{maxWidth:160}} />
                <button className="btn primary" onClick={saveCourse}>날짜별로 저장</button>
              </div>
              <small className="note">저장된 코스는 날짜별로 그룹화되어 조회 가능합니다.</small>
            </div>
          </div>
        </div>

        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>저장된 날짜별 코스</div>
          <div style={{marginTop:8}}>
            {Object.keys(courses).length === 0 ? <div className="muted">저장된 코스가 없습니다.</div> : Object.keys(courses).sort().reverse().map(date => (
              <div key={date} style={{marginBottom:12}}>
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                  <div><div style={{fontWeight:800}}>{date}</div><div className="muted small">{courses[date].length}개 코스</div></div>
                </div>
                <div style={{marginTop:8,display:'flex',flexDirection:'column',gap:8}}>
                  {courses[date].map(c => (
                    <div key={c.id} className="card" style={{padding:10}}>
                      <div style={{fontWeight:800}}>{c.name}</div>
                      <div style={{marginTop:8,display:'flex',gap:8,flexWrap:'wrap'}}>
                        {c.points && c.points.map(pt => <a key={pt.id} className="btn ghost" target="_blank" rel="noreferrer" href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(pt.name)}`}>{pt.name}</a>)}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </div>
      </div>
    );
  }

  /***** Settings Page *****/
  function SettingsPage({theme, setTheme, setDates, clearAll}){
    const [mode, setMode] = useState(theme.mode || 'light');
    const [accent, setAccent] = useState(theme.accent || '#1366ff');

    useEffect(()=> {
      setMode(theme.mode); setAccent(theme.accent);
    }, [theme]);

    function apply(){
      setTheme({mode, accent});
      alert('테마가 적용되었습니다.');
    }
    function resetDates(){
      if(confirm('저장된 여행 날짜를 초기화하시겠습니까?')){ localStorage.removeItem(KEY_DATES); setDates({from:'', to:'', saved:false}); alert('여행 날짜가 초기화되었습니다.'); }
    }

    return (
      <div>
        <h2>설정</h2>
        <div style={{marginTop:12}} className="grid-2">
          <div className="card">
            <div style={{fontWeight:800}}>테마</div>
            <div style={{marginTop:10}} className="col">
              <div className="row">
                <button className={`btn ${mode==='light' ? 'ghost' : ''}`} onClick={()=>setMode('light')}>라이트</button>
                <button className={`btn ${mode==='dark' ? 'ghost' : ''}`} onClick={()=>setMode('dark')}>다크</button>
              </div>
              <div style={{marginTop:10}}>
                <label className="muted small">액센트 색상 선택</label>
                <input type="color" value={accent} onChange={e=>setAccent(e.target.value)} style={{marginTop:8}} />
              </div>
              <div style={{marginTop:10}}>
                <button className="btn primary" onClick={apply}>적용</button>
              </div>
            </div>
          </div>

          <div className="card">
            <div style={{fontWeight:800}}>데이터 관리</div>
            <div style={{marginTop:10}}>
              <button className="btn ghost" onClick={resetDates}>저장된 여행 날짜 초기화</button>
            </div>
            <div style={{marginTop:12}}>
              <button className="btn ghost" onClick={()=>{
                if(confirm('로컬 데이터 전체를 삭제하시겠습니까?')){ clearAll(); }
              }}>로컬 데이터 전체 초기화</button>
            </div>
          </div>
        </div>
      </div>
    );
  }

  /***** Detail router & view *****/
  function DetailRouter({route, dates, flights, places, dests, points}){
    // route: e.g. "detail/flights/f123"
    const parts = route.split('/');
    const type = parts[1];
    const id = parts[2];
    if(type === 'flights') return <DetailFlight id={id} dates={dates} flights={flights} />;
    if(type === 'places') return <DetailPlace id={id} dates={dates} places={places} />;
    if(type === 'dests') return <DetailDest id={id} dates={dates} dests={dests} />;
    if(type === 'points') return <DetailPoint id={id} dates={dates} points={points} />;
    return <div className="muted">상세 항목을 찾을 수 없습니다.</div>;
  }

  function DetailFlight({id, dates, flights}){
    const item = flights.find(f=>f.id === id);
    if(!item) return (<div><h2>상세</h2><div className="muted">항목을 찾을 수 없습니다.</div></div>);
    return (
      <div>
        <h2>항공권 상세</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}
        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>{item.from} → {item.to}</div>
          <div className="muted small">{item.airline} · {item.depart} → {item.arrive}</div>
          <div style={{marginTop:8}} className="muted small">가격: {item.price} · 메모: {item.notes}</div>
          {item.site ? <div style={{marginTop:8}}><a className="btn primary" target="_blank" rel="noreferrer" href={item.site}>예약 사이트 열기</a></div> : null}
        </div>
      </div>
    );
  }
  function DetailPlace({id, dates, places}){
    const item = places.find(p=>p.id === id);
    if(!item) return (<div><h2>상세</h2><div className="muted">항목을 찾을 수 없습니다.</div></div>);
    return (
      <div>
        <h2>숙소 상세</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}
        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>{item.name}</div>
          <div className="muted small">{item.location} · {item.nights}박</div>
          <div style={{marginTop:8}} className="muted small">가격: {item.price} · 메모: {item.notes}</div>
          <div style={{marginTop:12}} className="map-wrap"><iframe className="map-iframe" title="place-map" src={`https://www.google.com/maps?q=${encodeURIComponent(item.location||item.name)}&output=embed`} /></div>
        </div>
      </div>
    );
  }
  function DetailDest({id, dates, dests}){
    const item = dests.find(d=>d.id === id);
    if(!item) return (<div><h2>상세</h2><div className="muted">항목을 찾을 수 없습니다.</div></div>);
    return (
      <div>
        <h2>여행지 상세</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}
        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>{item.name}</div>
          <div className="muted small">선호도: {item.pref}</div>
          <div style={{marginTop:12}} className="map-wrap"><iframe className="map-iframe" title="dest-map" src={`https://www.google.com/maps?q=${encodeURIComponent(item.query)}&output=embed`} /></div>
        </div>
      </div>
    );
  }
  function DetailPoint({id, dates, points}){
    const item = points.find(p=>p.id === id);
    if(!item) return (<div><h2>상세</h2><div className="muted">항목을 찾을 수 없습니다.</div></div>);
    return (
      <div>
        <h2>명소 상세</h2>
        {dates && dates.saved ? <div style={{marginTop:10}} className="date-banner"><div className="date-text">{formatRange(dates.from, dates.to)}</div><div className="muted">저장된 여행일</div></div> : null}
        <div style={{marginTop:12}} className="card">
          <div style={{fontWeight:800}}>{item.name}</div>
          <div className="muted small">{item.lat && item.lng ? `좌표: (${item.lat}, ${item.lng})` : '좌표 없음'}</div>
          {item.lat && item.lng ? <div style={{marginTop:12}} className="map-wrap"><iframe className="map-iframe" title="pt-map" src={`https://www.google.com/maps?q=${encodeURIComponent(item.lat + ',' + item.lng)}&output=embed`} /></div> : null}
        </div>
      </div>
    );
  }

  /***** Render App *****/
  ReactDOM.createRoot(document.getElementById('root')).render(React.createElement(App));
  </script>
</body>
</html>
